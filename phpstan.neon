includes:
    - ./vendor/larastan/larastan/extension.neon

parameters:
    level: 5
    paths:
        - app
        - config
        - database
        - routes

    # Bootstrap Laravel for proper reflection
    bootstrapFiles:
        - phpstan-bootstrap.php

    # Exclude paths
    excludePaths:
        - database/migrations/*

    # Treat PHPDoc types as hints, not strict facts (reduces false positives from PHPDocs)
    treatPhpDocTypesAsCertain: false

    # Do not report unmatched ignoreErrors entries as errors
    reportUnmatchedIgnoredErrors: false

    ignoreErrors:
        # -------------------------------------------------------------------------
        # Filament framework patterns
        # -------------------------------------------------------------------------
        # getRecord() returns Model|int|string — framework limitation
        - message: '#Cannot access property .+ on Illuminate\\Database\\Eloquent\\Model\|int\|string#'
        - message: '#Cannot call method .+ on Illuminate\\Database\\Eloquent\\Model\|int\|string#'
        # getHeaderActions() returning ActionGroup (which is a valid Filament action type)
        - message: '#should return array<Filament\\Actions\\Action>#'
        # SelectAction::default() — used for widget filter defaults
        - message: '#Call to an undefined method Filament\\Actions\\SelectAction::default\(\)#'
        # Filament Panel::login(false) — disables Filament login, valid at runtime
        - message: '#Filament\\Panel::login\(\) expects .+, false given#'
        # Filament component view-string property default value
        - identifier: property.defaultValue

        # -------------------------------------------------------------------------
        # Eloquent / Laravel patterns
        # -------------------------------------------------------------------------
        # Dynamic properties on the base Eloquent Model (polymorphic, raw queries, etc.)
        - message: '#Access to an undefined property Illuminate\\Database\\Eloquent\\Model::#'
        # Undefined methods on the base Eloquent Model (SoftDeletes, morphs, etc.)
        - message: '#Call to an undefined method Illuminate\\Database\\Eloquent\\Model::#'
        # Spatie Permission query scopes on Builder
        - message: '#Call to an undefined method Illuminate\\Database\\Eloquent\\Builder.*::(role|withoutRole)\(\)#'
        # view() with dynamic string — larastan requires literal view-string
        - message: '#function view expects view-string\|null, string given#'
        - message: '#method Illuminate\\Mail\\Mailable::view\(\) expects view-string, string given#'
        # Order aggregate query aliases (revenue, order_count via selectRaw)
        - message: '#Access to an undefined property App\\Models\\Order::\$(revenue|order_count)#'
        # Spatie hasPermissionTo interface contract vs implementation (guardName has default)
        - message: '#Method Spatie\\Permission\\Contracts\\Role::hasPermissionTo\(\) invoked with 1 parameter, 2 required#'
        # orderByHas custom query macro on Builder
        - message: '#Call to an undefined method Illuminate\\Database\\Eloquent\\Builder.+::orderByHas\(\)#'
        # hasManyThrough relation not detected by larastan
        - message: "#Relation 'tickets' is not found in App\\\\Models\\\\Order model#"
        # User::$phone accessed but not in User model (ProfileController)
        - message: '#Access to an undefined property App\\Models\\User::\$phone#'
        # User::$unreadNotifications — magic Notifiable relation property
        - message: '#Access to an undefined property App\\Models\\User::\$unreadNotifications#'

        # -------------------------------------------------------------------------
        # Third-party package patterns
        # -------------------------------------------------------------------------
        # Flowframe\Trend — conditionally used with class_exists() guard
        - message: '#Flowframe.+Trend#'
        # Laravolt Indonesia — City model uses magic properties
        - message: '#Laravolt.+Indonesia.+City::#'

        # -------------------------------------------------------------------------
        # Legacy / in-progress code
        # -------------------------------------------------------------------------
        # ImageService uses old Event columns (legacy banner storage)
        - message: '#Access to an undefined property App\\Models\\Event::\$(banner_image|thumbnail_400|thumbnail_800|thumbnail_1200)#'
        # OrderForm collection return type variance
        - message: '#Anonymous function should return Illuminate\\Support\\Collection<int, string\|null> but returns Illuminate\\Support\\Collection<int, string\|null>#'

        # -------------------------------------------------------------------------
        # Code quality identifiers (non-breaking, suppress noisy warnings)
        # -------------------------------------------------------------------------
        - identifier: nullsafe.neverNull
        - identifier: closure.unusedUse
        - identifier: return.unusedType
        - identifier: argument.unresolvableType
